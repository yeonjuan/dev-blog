
   <!doctype html>
    <html lang="ko">
      <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>node 패키지 브라우저에서 사용하기 (with Webpack 4) | DevBlog</title>
        <link href="/dev-blog/favicon.ico" rel="shortcut icon">
        <meta name="description" content=".....">
        <link href="/dev-blog/output.css" type="text/css" rel="stylesheet" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
          href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap"
          rel="stylesheet"
        />
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZBZX7LMVNE"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-ZBZX7LMVNE');
        </script>
        
      <link href="/dev-blog/css/github.min.css" type="text/css" rel="stylesheet" />
    
    
      </head>
      <body>
        <div class="relative">
            
  <style>
        .hamburger {
            cursor: pointer;
            justify-content: space-between;
            flex-direction: column;
        }
        .hamburger > div {
            height: 2px;
            transition: 0.2s ease-out;
            z-index: 999;
        }
        .menuInput:checked ~ .hamburger > div:nth-child(1) {
            transform: translateY(6.5px) rotate(45deg);
        }
        .menuInput:checked ~ .hamburger > div:nth-child(2) {
            opacity: 0;
        }
        .menuInput:checked ~ .hamburger > div:nth-child(3) {
            transform: translateY(-6.5px) rotate(-45deg);
        }
    </style>
  <div id="overlay" class="backdrop-blur-sm bg-black/20 dark:bg-slate-900/80 fixed h-full inset-0 hidden"></div>
  <header class="bg-zinc-800 text-white h-12 fixed flex justify-between items-center w-full px-4">
    <a
      class="w-10 flex items-center justify-center"
      href="https://github.com/yeonjuan/dev-blog"
      target="_blank"
      rel="noopener noreferrer"
    >
      <img
        src="/dev-blog/assets/ic-github.svg"
        alt="go to github"
        width="20"
      >
    </a>
    <span>
      <a href="/dev-blog/">
        DEV BLOG
      </a>
    </span>
    <div class="w-10">
      <input
        id="menu"
        type="checkbox"
        class="menuInput peer sr-only hidden"
        aria-hidden="true"
      >
      <label
        for="menu"
        aria-label="menu button"
        class="hamburger flex flex-col justify-between ml-auto h-[21px] w-[21px] px-[1px] py-[3px] [&>div]:h-[2px] [&>div]:w-[18px] [&>div]:bg-white hover:cursor-pointer"
      >
        <div></div>
        <div></div>
        <div></div>
      </label>
      <nav class="fixed text-black transition-[max-height] duration-200 overflow-hidden max-h-0 top-12 left-[0px] peer-checked:max-h-[200px] bg-white w-full border-b border-black">
        <ul class="p-4">
          <li>
            <a class="inline-block w-full h-full py-2 hover:underline cursor-pointer" href="/dev-blog/">HOME</a>
          </li>
          <li>
            <a class="inline-block w-full h-full py-2 hover:underline cursor-pointer" href="/dev-blog/posts/JavaScript">JavaScript</a>
          </li>
          <li>
            <a class="inline-block w-full h-full py-2 hover:underline cursor-pointer" href="/dev-blog/posts/Review">Review</a>
          </li>
          <li>
            <a class="inline-block w-full h-full py-2 hover:underline cursor-pointer" href="/dev-blog/posts/Browser">Browser</a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

          <main class="py-2 px-4 pt-10 max-w-3xl m-auto pb-20">
          
            <aside class="mt-14">
              <a href="/dev-blog/" class="hover:underline">Home</a> &gt; <a href="/dev-blog/posts/JavaScript" class="hover:underline">JavaScript</a> &gt; <a href="/dev-blog/posts/JavaScript/node-module-on-browser" class="hover:underline">node 패키지 브라우저에서 사용하기 (with Webpack 4)</a>
            </aside>
          
            
    <h1 id="node-with-webpack-4" class="text-2xl my-8 font-bold">
      node 패키지 브라우저에서 사용하기 (with Webpack 4)
    </h1><p class="my-1 text-sm leading-7 mb-6">웹팩을 사용해서, <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">fs</code>, <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">path</code>와 같은 NodeJS Built-In 모듈을 사용하는 패키지를 브라우저에서 동작하도록 땜질식(?)으로 번들링해본 후기입니다.<br>간단한 결론만 원하신다면 <a href="#summary" class="text-orange-500">Summary</a> 를 참고하세요.</p>
    <h2 id="" class="text-xl my-4 font-semibold">
      이유
    </h2><p class="my-1 text-sm leading-7 mb-6">근래에 TypeScript에 흥미를 느껴 <a href="https://github.com/typescript-eslint/typescript-eslint" class="text-orange-500">typescript-eslint</a> 프로젝트에 조금씩 컨트리뷰션을 하고 있습니다.
컨트리뷰션을 하기 위해 해결할 이슈를 재현해 보곤 하는데, 매번 이슈를 재현하기 위해 프로젝트의 테스트 코드를 찾아서 수정하는 것이 귀찮게 느껴졌습니다.</p><p class="my-1 text-sm leading-7 mb-6">ESLint에서는 이를 위해 <a href="https://eslint.org/demo" class="text-orange-500">Online Demo</a>를 제공하고 있는데 이슈를 재현하고 공유할 때 유용하게 사용됩니다. 
<img class="my-4 border-gray-300 border rounded-sm p-1" src="./assets/eslint-demo.png"></p><p class="my-1 text-sm leading-7 mb-6">이에 typescript-eslint 를 지원하는 웹 데모를 만들어 보면 좋겠다고 생각하였고 이를 만들며 겪었던 문제점과 해결 방법을 정리해 보았습니다. </p>
    <h2 id="" class="text-xl my-4 font-semibold">
      문제점
    </h2><p class="my-1 text-sm leading-7 mb-6">typescript-eslint를 브라우저에서 동작시키기 위해서는 typescript-eslint 프로젝트뿐만 아니라 eslint 도 브라우저에서 동작시켜야 합니다. 하지만 해당 프로젝트들은 NodeJS 에서 동작하는 패키지이고 브라우저에서 동작을 지원하지 않습니다.</p><p class="my-1 text-sm leading-7 mb-6">NodeJS 의 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">fs</code>, <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">path</code> 와 같은 built-in 모듈을 사용하는 패키지를 웹팩을 이용해 번들해야 했는데 번들시 해당 모듈을 찾지 못해 아래와 같은 에러가 발생하게 됩니다.</p><pre><code class="my-4 hljs text-xs language-">ERROR in ./node_modules/@eslint/eslintrc/lib/config-array-factory.js
Module not found: Error: Can&#x27;t resolve &#x27;fs&#x27; in &#x27;...project/node_modules/@eslint/eslintrc/lib&#x27;</code></pre><p class="my-1 text-sm leading-7 mb-6">결국 번들링을 해서 사용하기 위해서는 NodeJS built-in 모듈을 사용하는 모듈을 별도로 처리해 주어야 했습니다.</p><p class="my-1 text-sm leading-7 mb-6">처리해야 할 모듈은 런타임에 따라 아래 두 가지 경우로 나눌 수 있었습니다.</p><ul class="my-2 px-3"><li  class="text-base *:mb-0 *:mt-0 *:leading-6"><p class="my-1 text-sm leading-7 mb-6">NodeJS Built-In 모듈을 사용하지만, <strong>런타임에는 필요 없는 모듈</strong></p></li><li  class="text-base *:mb-0 *:mt-0 *:leading-6"><p class="my-1 text-sm leading-7 mb-6">NodeJS Built-In 모듈을 사용하고, <strong>런타임에도 필요한 모듈</strong></p></li></ul>
    <h2 id="-1" class="text-xl my-4 font-semibold">
      해결 1. 런타임에 필요 없는 모듈
    </h2><p class="my-1 text-sm leading-7 mb-6">번들 결과에서 실제로 런타임에는 필요가 없는 모듈이 있는데, 예를 들어 ESLint에서 CLI 동작을 담당하는 모듈이 있습니다. 이 모듈은 브라우저 데모 동작시에는 실제로 동작할 필요가 없습니다.</p><p class="my-1 text-sm leading-7 mb-6">이 경우 <a href="https://webpack.js.org/loaders/null-loader/" class="text-orange-500">웹팩 - null-loader</a> 를 사용하면 해당 모듈을 빈 모듈로 변경할 수 있습니다.</p><p class="my-1 text-sm leading-7 mb-6">먼저 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">null-loader</code> 를 설치합니다.</p><pre><code class="my-4 hljs text-xs language-">$ npm install null-loader --save-dev</code></pre><p class="my-1 text-sm leading-7 mb-6">이후, 웹팩 설정의 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">rules</code> 에 아래와 같이 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">null-loader</code>를 추가해 줍니다. <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">test</code>에는 비어있는 모듈로 교체할 모듈을 명시해 줍니다.</p><ul class="my-2 px-3"><li  class="text-base *:mb-0 *:mt-0 *:leading-6"><p class="my-1 text-sm leading-7 mb-6"><a href="https://github.com/yeonjuan/typescript-eslint-demo/blob/master/webpack.base.config.js#L20-L34" class="text-orange-500">webpack.config.js</a></p><pre><code class="my-4 hljs text-xs language-js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">rules</span>: [
    <span class="hljs-comment">//...</span>
    {
      <span class="hljs-attr">test</span>: [
        <span class="hljs-regexp">/\/eslint\/.*\/cli-engine/</span>,
        <span class="hljs-comment">// ...</span>
      ],
      <span class="hljs-attr">use</span>: <span class="hljs-string">&quot;null-loader&quot;</span>
    }
  ]
}</code></pre></li></ul><p class="my-1 text-sm leading-7 mb-6">번들시 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">null-loader</code> 에 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">test</code> 에 설정한 모듈은 비어있는 모듈이 됩니다. 아무런 기능이 없는 모듈이 번들되게 되지만 실제로 런타임에는 사용되지 않기 때문에 동작에 아무런 문제가 되지 않습니다.</p>
    <h2 id="-2" class="text-xl my-4 font-semibold">
      해결 2: 런타임에도 필요한 모듈
    </h2><p class="my-1 text-sm leading-7 mb-6">null-loader 를 사용해 대부분의 번들링 에러를 회피할 수 있었습니다 하지만 런타임에 실제로 사용되는 모듈에 null-loader 를 사용하면 실제 코드 동작시에 에러가 발생하게 됩니다.</p><p class="my-1 text-sm leading-7 mb-6">typescript-eslint 에서는 설정에 따라 tsconfig.json 파일의 경로를 반환하는 용도로 <a href="https://www.npmjs.com/package/globby" class="text-orange-500">globby</a>를 사용하고 있었고, globby 는 내부에서 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">fs</code> 를 사용하고 있습니다. 때문에 typescript-eslint 를 번들시  globby 에서 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">fs</code>를 찾지 못한다는 에러가 발생하게 됩니다.</p><ul class="my-2 px-3"><li  class="text-base *:mb-0 *:mt-0 *:leading-6"><p class="my-1 text-sm leading-7 mb-6"><a href="https://github.com/typescript-eslint/typescript-eslint/blob/90a587845088da1b205e4d7d77dbc3f9447b1c5a/packages/typescript-estree/src/parser.ts" class="text-orange-500">@typescript-eslint/parser</a></p><pre><code class="my-4 hljs text-xs language-ts"><span class="hljs-keyword">import</span> { sync <span class="hljs-keyword">as</span> globSync } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;globby&#x27;</span>;

<span class="hljs-comment">//...</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">prepareAndTransformProjects</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">//...</span>
  <span class="hljs-title function_">globSync</span>([...globbedProjects, ...ignoreListInput], {
    <span class="hljs-attr">cwd</span>: extra.<span class="hljs-property">tsconfigRootDir</span>,
  });
}</code></pre></li></ul><p class="my-1 text-sm leading-7 mb-6">이 경우 <a href="https://webpack.js.org/plugins/normal-module-replacement-plugin/" class="text-orange-500">NormalModuleReplacementPlugin</a>를 사용할 수 있습니다. NormalModuleReplacementPlugin 은 웹팩 번들시에 특정 모듈을 내가 정의한 커스텀 모듈로 교체해 사용할 수 있습니다</p><p class="my-1 text-sm leading-7 mb-6">먼저 해당 모듈을 대체해서 동작할 모듈을 간단하게 작성합니다.(Node Built-In 을 사용하는 패키지를 목킹한다고 생각하면 됩니다)</p><ul class="my-2 px-3"><li  class="text-base *:mb-0 *:mt-0 *:leading-6"><p class="my-1 text-sm leading-7 mb-6"><a href="https://github.com/typescript-eslint/typescript-eslint/blob/90a587845088da1b205e4d7d77dbc3f9447b1c5a/packages/typescript-estree/src/parser.ts#L2" class="text-orange-500">/src/modules/globby.js</a></p><pre><code class="my-4 hljs text-xs language-js"><span class="hljs-comment">// src/modules/globby.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-title function_">sync</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> [<span class="hljs-string">&quot;./tsconfig.json&quot;</span>];
  },
};</code></pre></li></ul><p class="my-1 text-sm leading-7 mb-6">이후 웹팩 설정에서 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">plugins</code> 에 NormalModuleReplacementPlugin로 해당 모듈을 대체할 커스텀 모듈로 대체합니다.</p><ul class="my-2 px-3"><li  class="text-base *:mb-0 *:mt-0 *:leading-6"><p class="my-1 text-sm leading-7 mb-6"><a href="https://github.com/yeonjuan/typescript-eslint-demo/blob/master/webpack.base.config.js#L76-L78" class="text-orange-500">webpack.config.js</a></p><pre><code class="my-4 hljs text-xs language-js"><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;webpack&#x27;</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">//...</span>
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">NormalModuleReplacementPlugin</span>(
      <span class="hljs-regexp">/globby/</span>, <span class="hljs-comment">// 교체 대상 모듈</span>
      <span class="hljs-string">&quot;src/modules/globby.js&quot;</span> <span class="hljs-comment">// 대신 사용할 모듈</span>
    ),
  ]
}</code></pre></li></ul><p class="my-1 text-sm leading-7 mb-6">이제 웹팩으로 번들시 typescript-eslint 내부에서 import 해서 사용하는 globby 는 제 프로젝트에 있는 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">src/modules/globby.js</code> 로 대체되게 됩니다.</p>
    <h2 id="" class="text-xl my-4 font-semibold">
      결론
    </h2><p class="my-1 text-sm leading-7 mb-6">결론적으로 위와 같은 과정(삽질?) 을 통해 <a href="https://github.com/yeonjuan/typescript-eslint-demo" class="text-orange-500">typescript-eslint-demo</a>를 완성하게 되었습니다.</p><p class="my-1 text-sm leading-7 mb-6"><img class="my-4 border-gray-300 border rounded-sm p-1" src="./assets/tseslint-demo.png"></p><p class="my-1 text-sm leading-7 mb-6">사이드 프로젝트였고 어찌 되었든 동작하는 것이 가장 큰 목표였기 때문에 위와 같은 삽질을 하게 되었는데요.</p><p class="my-1 text-sm leading-7 mb-6">정리해 놓고 보니 간단하지만 실제 과정은 녹록친 않았습니다. eslint, tyescript-eslint 내부에 어떤 모듈에서 Node Built-In 모듈을 사용하는지 파악하는게 어려웠기 때문에 매번 번들링을 시도하면서 에러가 발생하면 실제 코드를 찾아보고 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">null-loader</code> 나 <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">NormalModuleReplacementPlugin</code> 으로 땜질(?)하듯이 작업해야 했습니다.</p><p class="my-1 text-sm leading-7 mb-6">작업 결과뿐 아니라 유지 보수 관점에서도 단점이 있는데요. 번들할 패키지가 의존하는 모듈에 의존적인 웹팩설정이기 때문에, 패키지 업데이트에 많이 취약하다는 단점이 있습니다. </p><blockquote class="border-l-2 border-black pl-2 my-4"><p class="my-1 text-sm leading-7 mb-6">typescript-eslint 에서 구조 리팩터링이 있다면 ... 웹팩을 다시 설정해야겠죠..?</p></blockquote><p class="my-1 text-sm leading-7 mb-6">때문에 실제 업무였다면 좀더 좋은 방법을 찾아보았을 것 같습니다.</p><p class="my-1 text-sm leading-7 mb-6">어찌 되었든 완성된 Online Demo 를 <a href="https://github.com/eslint/eslint/issues/13758#issuecomment-709353258" class="text-orange-500">ESLint 메인테이너분도 사용해 주시기도 하고</a>, <a href="https://github.com/typescript-eslint/typescript-eslint/issues/2703#issuecomment-715685452" class="text-orange-500">저도 이슈를 재현하고 사용자와 공유하는데</a> 사용중이라 만든 보람은 느껴지는 프로젝트였습니다.</p>
    <h2 id="summary" class="text-xl my-4 font-semibold">
      Summary
    </h2><p class="my-1 text-sm leading-7 mb-6"><code class="bg-gray-100 px-1 rounded-md inline-block text-sm">fs</code>, <code class="bg-gray-100 px-1 rounded-md inline-block text-sm">path</code> 와 같은 NodeJS 모듈을 사용하는 패키지를 웹팩으로 번들하는 경우, 런타임에 필요없는 모듈은 <a href="https://webpack.js.org/loaders/null-loader/" class="text-orange-500">null-loader</a>, 런타임에도 필요한 모듈은 <a href="https://webpack.js.org/plugins/normal-module-replacement-plugin/" class="text-orange-500">NormalModuleReplacementPlugin</a> 를 활용해 보세요. </p>
          </main>
        </div>
        <script src="/dev-blog/scripts/header.js"></script>
      </body>
    </html>
    